# Generated by Django 2.2.13 on 2020-08-31 09:27

from django.db import migrations, models, transaction


accessor_names = [
    # (model name, accessor name)
    ('Ausgabe', 'audio'), ('Audio', 'band'), ('Audio', 'genre'), ('Audio', 'ort'),
    ('Audio', 'person'), ('Audio', 'plattenfirma'), ('Audio', 'schlagwort'),
    ('Audio', 'spielort'), ('Audio', 'veranstaltung'),
    ('Artikel', 'autor'), ('Artikel', 'band'), ('Artikel', 'genre'), ('Artikel', 'musiker'),
    ('Artikel', 'ort'), ('Artikel', 'person'), ('Artikel', 'schlagwort'),
    ('Artikel', 'spielort'), ('Artikel', 'veranstaltung'),
    ('Band', 'genre'), ('Band', 'musiker'), ('Autor', 'magazin'),
    ('Magazin', 'genre'), ('Magazin', 'verlag'), ('Magazin', 'herausgeber'),
    ('Musiker', 'genre'), ('Musiker', 'instrument')
]

data = {}


def get_m2m_model(apps, model_name, accessor_name):
    return getattr(apps.get_model('DBentry', model_name), accessor_name).through


def backup_data(apps, schema_editor):
    for model_name, accessor_name in accessor_names:
        m2m_data = list(get_m2m_model(apps, model_name, accessor_name).objects.values())
        data["%s.%s" % (model_name, accessor_name)] = m2m_data


@transaction.atomic
def load_data(apps, schema_editor):
    for model_name, accessor_name in accessor_names:
        m2m_data = data["%s.%s" % (model_name, accessor_name)]
        m2m_model = get_m2m_model(apps, model_name, accessor_name)
        new_objects = []
        for values in m2m_data:
            new_objects.append(m2m_model(**values))
        m2m_model.objects.bulk_create(new_objects)


class Migration(migrations.Migration):

    dependencies = [
        ('DBentry', '0002_rename_kalendar_to_kalender'),
    ]

    operations = [
        # Make a backup of the data of to be deleted m2m models
        # (or apply the backup if reverse):
        migrations.RunPython(backup_data, load_data, elidable=True),
        # Temporarily remove the m2m fields:
        migrations.RemoveField(
            model_name='artikel',
            name='autor',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='band',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='musiker',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='ort',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='person',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='schlagwort',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='spielort',
        ),
        migrations.RemoveField(
            model_name='artikel',
            name='veranstaltung',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='band',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='ort',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='person',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='plattenfirma',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='schlagwort',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='spielort',
        ),
        migrations.RemoveField(
            model_name='audio',
            name='veranstaltung',
        ),
        migrations.RemoveField(
            model_name='ausgabe',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='autor',
            name='magazin',
        ),
        migrations.RemoveField(
            model_name='band',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='band',
            name='musiker',
        ),
        migrations.RemoveField(
            model_name='magazin',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='magazin',
            name='herausgeber',
        ),
        migrations.RemoveField(
            model_name='magazin',
            name='verlag',
        ),
        migrations.RemoveField(
            model_name='musiker',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='musiker',
            name='instrument',
        ),
        # Delete the m2m models:
        migrations.AlterUniqueTogether(
            name='m2m_artikel_band',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_band',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_band',
            name='band',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_genre',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_genre',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_genre',
            name='genre',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_musiker',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_musiker',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_musiker',
            name='musiker',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_ort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_ort',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_ort',
            name='ort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_person',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_person',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_person',
            name='person',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_schlagwort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_schlagwort',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_schlagwort',
            name='schlagwort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_spielort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_spielort',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_spielort',
            name='spielort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_artikel_veranstaltung',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_veranstaltung',
            name='artikel',
        ),
        migrations.RemoveField(
            model_name='m2m_artikel_veranstaltung',
            name='veranstaltung',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_ausgabe',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_ausgabe',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_ausgabe',
            name='ausgabe',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_band',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_band',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_band',
            name='band',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_genre',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_genre',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_genre',
            name='genre',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_ort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_ort',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_ort',
            name='ort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_person',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_person',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_person',
            name='person',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_plattenfirma',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_plattenfirma',
            name='plattenfirma',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_schlagwort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_schlagwort',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_schlagwort',
            name='schlagwort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_spielort',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_spielort',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_spielort',
            name='spielort',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_audio_veranstaltung',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_audio_veranstaltung',
            name='audio',
        ),
        migrations.RemoveField(
            model_name='m2m_audio_veranstaltung',
            name='veranstaltung',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_autor_magazin',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_autor_magazin',
            name='autor',
        ),
        migrations.RemoveField(
            model_name='m2m_autor_magazin',
            name='magazin',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_band_genre',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_band_genre',
            name='band',
        ),
        migrations.RemoveField(
            model_name='m2m_band_genre',
            name='genre',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_band_musiker',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_band_musiker',
            name='band',
        ),
        migrations.RemoveField(
            model_name='m2m_band_musiker',
            name='musiker',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_magazin_genre',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_genre',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_genre',
            name='magazin',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_magazin_herausgeber',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_herausgeber',
            name='herausgeber',
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_herausgeber',
            name='magazin',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_magazin_verlag',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_verlag',
            name='magazin',
        ),
        migrations.RemoveField(
            model_name='m2m_magazin_verlag',
            name='verlag',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_musiker_genre',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_musiker_genre',
            name='genre',
        ),
        migrations.RemoveField(
            model_name='m2m_musiker_genre',
            name='musiker',
        ),
        migrations.AlterUniqueTogether(
            name='m2m_musiker_instrument',
            unique_together=None,
        ),
        migrations.RemoveField(
            model_name='m2m_musiker_instrument',
            name='instrument',
        ),
        migrations.RemoveField(
            model_name='m2m_musiker_instrument',
            name='musiker',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_autor',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_band',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_genre',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_musiker',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_ort',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_person',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_schlagwort',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_spielort',
        ),
        migrations.DeleteModel(
            name='m2m_artikel_veranstaltung',
        ),
        migrations.DeleteModel(
            name='m2m_audio_ausgabe',
        ),
        migrations.DeleteModel(
            name='m2m_audio_band',
        ),
        migrations.DeleteModel(
            name='m2m_audio_genre',
        ),
        migrations.DeleteModel(
            name='m2m_audio_ort',
        ),
        migrations.DeleteModel(
            name='m2m_audio_person',
        ),
        migrations.DeleteModel(
            name='m2m_audio_plattenfirma',
        ),
        migrations.DeleteModel(
            name='m2m_audio_schlagwort',
        ),
        migrations.DeleteModel(
            name='m2m_audio_spielort',
        ),
        migrations.DeleteModel(
            name='m2m_audio_veranstaltung',
        ),
        migrations.DeleteModel(
            name='m2m_autor_magazin',
        ),
        migrations.DeleteModel(
            name='m2m_band_genre',
        ),
        migrations.DeleteModel(
            name='m2m_band_musiker',
        ),
        migrations.DeleteModel(
            name='m2m_magazin_genre',
        ),
        migrations.DeleteModel(
            name='m2m_magazin_herausgeber',
        ),
        migrations.DeleteModel(
            name='m2m_magazin_verlag',
        ),
        migrations.DeleteModel(
            name='m2m_musiker_genre',
        ),
        migrations.DeleteModel(
            name='m2m_musiker_instrument',
        ),
        # Re-add the m2m fields:
        migrations.AddField(
            model_name='artikel',
            name='autor',
            field=models.ManyToManyField(to='DBentry.Autor'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='band',
            field=models.ManyToManyField(to='DBentry.Band'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='genre',
            field=models.ManyToManyField(to='DBentry.Genre'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='musiker',
            field=models.ManyToManyField(to='DBentry.Musiker'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='ort',
            field=models.ManyToManyField(to='DBentry.Ort'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='person',
            field=models.ManyToManyField(to='DBentry.Person'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='schlagwort',
            field=models.ManyToManyField(to='DBentry.Schlagwort'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='spielort',
            field=models.ManyToManyField(to='DBentry.Spielort'),
        ),
        migrations.AddField(
            model_name='artikel',
            name='veranstaltung',
            field=models.ManyToManyField(to='DBentry.Veranstaltung'),
        ),
        migrations.AddField(
            model_name='audio',
            name='band',
            field=models.ManyToManyField(to='DBentry.Band'),
        ),
        migrations.AddField(
            model_name='audio',
            name='genre',
            field=models.ManyToManyField(to='DBentry.Genre'),
        ),
        migrations.AddField(
            model_name='audio',
            name='ort',
            field=models.ManyToManyField(to='DBentry.Ort'),
        ),
        migrations.AddField(
            model_name='audio',
            name='person',
            field=models.ManyToManyField(to='DBentry.Person'),
        ),
        migrations.AddField(
            model_name='audio',
            name='plattenfirma',
            field=models.ManyToManyField(to='DBentry.Plattenfirma'),
        ),
        migrations.AddField(
            model_name='audio',
            name='schlagwort',
            field=models.ManyToManyField(to='DBentry.Schlagwort'),
        ),
        migrations.AddField(
            model_name='audio',
            name='spielort',
            field=models.ManyToManyField(to='DBentry.Spielort'),
        ),
        migrations.AddField(
            model_name='audio',
            name='veranstaltung',
            field=models.ManyToManyField(to='DBentry.Veranstaltung'),
        ),
        migrations.AddField(
            model_name='ausgabe',
            name='audio',
            field=models.ManyToManyField(to='DBentry.Audio'),
        ),
        migrations.AddField(
            model_name='autor',
            name='magazin',
            field=models.ManyToManyField(to='DBentry.Magazin'),
        ),
        migrations.AddField(
            model_name='band',
            name='genre',
            field=models.ManyToManyField(to='DBentry.Genre'),
        ),
        migrations.AddField(
            model_name='band',
            name='musiker',
            field=models.ManyToManyField(to='DBentry.Musiker'),
        ),
        migrations.AddField(
            model_name='magazin',
            name='genre',
            field=models.ManyToManyField(to='DBentry.Genre'),
        ),
        migrations.AddField(
            model_name='magazin',
            name='herausgeber',
            field=models.ManyToManyField(to='DBentry.Herausgeber'),
        ),
        migrations.AddField(
            model_name='magazin',
            name='verlag',
            field=models.ManyToManyField(to='DBentry.Verlag'),
        ),
        migrations.AddField(
            model_name='musiker',
            name='genre',
            field=models.ManyToManyField(to='DBentry.Genre'),
        ),
        migrations.AddField(
            model_name='musiker',
            name='instrument',
            field=models.ManyToManyField(to='DBentry.Instrument'),
        ),
        # Apply the backup or create one if reversing:
        migrations.RunPython(load_data, backup_data, elidable=True),
    ]
